/*
 * SimpleLoadFile, Copyright 2014, CDCabrera, MIT license
 * Aspects of jQuery, MIT license
 * Aspect of the IE8 css event, Pete Otaqui, https://gist.github.com/pete-otaqui/3912307
 * Similar concept as LABjs, MIT license
 */
!function(e,t){"use strict";var a={filesLoaded:{},filesFailed:{},loadedIds:[],waitQueues:[],ieError:null};e.resourceLoad=function(){function i(e){e="[object Array]"==Object.prototype.toString.call(e)?e:[{file:e}];for(var a=[],i=w.id,n=w.timeout,o=p(i,"wait"),l=0;l<e.length;l++){var s={},d="string"==typeof e[l]?{file:e[l]}:e[l];s.globalId=i,s.id=d.id?d.id:null,s.wait=d.wait?d.wait:[],s.cache=d.cache===t||d.cache?!0:!1,s.file="string"==typeof d.file?d.file.replace(/\s+$/,""):null,s.type=d.type?d.type.toLowerCase():/\.js.*$/i.test(d.file)?"js":"css",s.success=d.success?d.success:null,s.error=d.error?d.error:null,s.timeout=d.timeout?d.timeout:n,s.file&&(s.id||(s.id=s.file),s.wait&&(s.wait=g(s.wait)),o&&(s.wait=g(o,s.wait)),s.wait&&s.wait.length&&(s.defer=!0),s.cache||(s.file+="{0}resourceLoad={1}".replace("{0}",/\?.*\=/.test(s.file)?"&":"?").replace("{1}",1e5*Math.random())),a.push(s))}r(a)}function r(e){(e.length||(e=f(),e.length))&&(e[0].wait.length?(c(e[0]),s(null,{type:"waiting"},[e[0]]),e.shift(),r(e)):n(e))}function n(e){var t=e[0],a=t.type+"-"+1e5*Math.random(),i=document.createElement("js"===t.type?"script":"link"),r=document.head||document.getElementsByTagName("head")[0]||document.documentElement,n=setTimeout(function(){i.onload({type:"timeout"})},t.timeout),l=!1;switch(i.id=a,t.type){case"js":t.defer||(i.async=!0),i.src=t.file;break;case"css":i.rel="stylesheet",i.href=t.file}switch("hasOwnProperty"in i&&"onload"in i?i.onerror=i.onload=function(t){clearTimeout(n),this.onerror=this.onload=null;var a=this;setTimeout(function(){s(a,t,e)},0)}:i.readyState?o(e,t,a,i,n):(clearTimeout(n),l=!0),t.type){case"js":r.insertBefore(i,r.firstChild);break;default:r.appendChild(i)}l&&s(i,{type:"contextfail"},e)}function o(e,t,a,i,r){l(),i.onload=i.onreadystatechange=function(i){if(!this.readyState||/loaded|complete/.test(this.readyState)){clearTimeout(r),this.onload=this.onreadystatechange=null;var n=i&&i.type?i:{type:"contextfail"},o=null,l=0,d=null;if("contextfail"===n.type)if("js"===t.type)n.type="load",o=w.data.ieError,o&&o.file===this.src&&(n.type="error");else{n.type="error",l=document.styleSheets.length;try{for(;l--;)if(d=document.styleSheets[l],d.id===a){""!==d.cssText&&(n.type="load");break}}catch(u){}}s(this,n,e,!0)}}}function l(){if(!e.onerror||!e.onerror.__data__){var t=e.onerror?e.onerror:function(){};e.onerror=function(e,a,i){w.data.ieError={message:e,file:a,line:i},t.apply(this,arguments)},e.onerror.__data__=!0}}function s(e,a,i,n){var o=i.shift(),l=o.globalId,s=a&&("error"===a.type||"timeout"===a.type),c=s?o.error:o.success,f=[a.type,o.file||null,o||null],y=p(o.globalId,"update"),g=p(o.globalId,"success"),m=p(o.globalId,"error");if(e&&e.parentNode&&"js"===o.type&&!n&&e.parentNode.removeChild(e),d(y,f),"waiting"!==a.type){if(u(s,o),c&&c.apply(e,f),s)return d(m,{success:w.data.filesLoaded[l],error:w.data.filesFailed[l]}),t;w.data[l].length-=1,h(o.id),w.data[l].length>0||d(g,{success:w.data.filesLoaded[l],error:w.data.filesFailed[l]}),r(i)}}function d(e,t){if(e){e=g(e),t=g(t);for(var a=0;a<e.length;a++)e[a].apply(null,t)}}function u(e,t){var a=t.globalId;e?(w.data.filesFailed[a]||(w.data.filesFailed[a]=[]),w.data.filesFailed[a].push(t)):(w.data.filesLoaded[a]||(w.data.filesLoaded[a]=[]),w.data.filesLoaded[a].push(t))}function c(e){w.data.waitQueues.push(e)}function f(){for(var e=w.data.waitQueues,t=w.data.loadedIds.join(","),a=[],i=[],r=0;r<e.length;r++){for(var n=[],o=0;o<e[r].wait.length;o++)t.indexOf(e[r].wait[o])<0&&n.push(e[r].wait[o]);e[r].wait=n,e[r].wait.length?i.push(e[r]):a.push(e[r])}return w.data.waitQueues=i,a}function h(e){w.data.loadedIds.push(e)}function p(e,t){var a=w.data[e],i=null;return a&&a[t]&&(i=a[t]),i}function y(e,t,a){w.data[e][t]=a}function g(){for(var e=Array.prototype.slice.call(arguments),t=[];e.length;){var a=e.shift();"[object Array]"===Object.prototype.toString.call(a)?t=t.concat(a):a&&t.push(a)}return t}function m(e,t,a){var i=p(e,t);i||(i=[]),i=g(i,a),y(e,t,i)}var w={data:a,id:1e5*Math.random(),timeout:1e4,files:g.apply(null,arguments)};return w.data[w.id]={length:w.files.length},setTimeout(function(){i(w.files)},0),{update:function(e){return m(w.id,"update",e),this},complete:function(e,t){return this.success(e),this.error(t),this},success:function(e){return m(w.id,"success",e),this},error:function(e){return m(w.id,"error",e),this},wait:function(){return m(w.id,"wait",Array.prototype.slice.call(arguments)),this}}}}(this);